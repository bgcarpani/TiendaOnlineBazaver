@model Bazaver2.ViewModel.AgregarProdViewModel
@using PagedList.Mvc;

@{
    Layout = null;
}



<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Bazaver Lobos</title>
    <link rel="icon" type="image/x-icon" href="~/Content/Images/bazaverfavicon.ico" />
    @*Font Awesome icons (free version)*@
    <script src="https://use.fontawesome.com/releases/v5.13.0/js/all.js" crossorigin="anonymous"></script>
    @*Google fonts*@
    @*<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700" rel="stylesheet" type="text/css" />*@
    <!--datatable   -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
            crossorigin="anonymous"></script>
    @*<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.js"></script>*@
    <script type="text/javascript" charset="utf8" src="~/Content/js/jquery.dataTables.js"></script>
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="~/Content/css/styles.css" rel="stylesheet" />
    <link href="~/Content/css/pager.css" rel="stylesheet" />

</head>
<body id="page-top">
    <!-- Navigation-->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top" style="background-color:black" id="mainNav">
        <div class="container">
            <a class="navbar-brand js-scroll-trigger" href="~/Home/Index"><img src="~/Content/assets/img/bazaverlogo.png" alt="" /></a> @*LOGO*@
            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                Menu
                <i class="fas fa-bars ml-1"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav text-uppercase ml-auto">

                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="~/Home/Index#services">Servicios</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="~/Home/Index#portfolio">Fotografía</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="~/Home/Index#about">Productos</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="~/Home/Index#team">Nosotros</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="~/Home/Index#contact">Contacto</a></li>
                    @using (Html.BeginForm("LogOff", "Account", FormMethod.Post, new { id = "logoutForm", @class = "navbar-right" }))
                    {
                        @Html.AntiForgeryToken()

                        if (User.IsInRole("Admin"))
                        {
                            <li class="nav-item"><a class="nav-link js-scroll-trigger" href="~/Ventas/Index">Panel</a></li>
                            <li class="nav-item"><a class="nav-link js-scroll-trigger" href="javascript:document.getElementById('logoutForm').submit()">Log Off</a></li>
                        }
                        else if (User.IsInRole("Mayorista"))
                        {
                            <ul class="navbar-nav text-uppercase ml-auto">
                                <li class="nav-item"><a class="nav-link js-scroll-trigger" href="javascript:document.getElementById('logoutForm').submit()">Log Off</a></li>
                            </ul>
                        }
                        else
                        {
                            <ul class="navbar-nav text-uppercase ml-auto">
                                <li class="nav-item"><a class="nav-link js-scroll-trigger" href="~/Account/Login">Iniciar Sesión</a></li>
                            </ul>

                        }
                    }

                    @*@Html.Partial("_LoginPartial")*@
                </ul>
            </div>
        </div>
    </nav>
    <header class="masthead" style="background-image:none">

        <div class="container; col-12">
            <div class="row">
                <div class=" col-lg-7 col-md-7">
                    <h2 style="color:black; text-align:left">
                        Productos
                    </h2>

                    <table class="display" id="productos" align="left" style="padding-left:15px">
                        <thead>
                            <tr>
                                <th>
                                    Imagen
                                </th>
                                <th>
                                    Producto
                                </th>


                                <th>
                                    Categoría
                                </th>
                                <th>
                                    Precio
                                </th>
                                <th>

                                </th>
                            </tr>
                        </thead>

                        <tbody>
                            @foreach (var item in Model.AgregarProdPagedListVM)
                            {
                                <tr>
                                    <td>
                                        @if (!string.IsNullOrEmpty(item.Image))
                                        {
                                            <a class="image-link" data-toggle="modal" href="#imageModal" data-productName='@item.Descripcion' data-image='@item.Image.Trim('~')'>
                                                <img class="border border-primary rounded" src="@Url.Content(item.Image)"
                                                     alt="image" style="width:100px;height:100px;max-width: 100%; height: auto;">
                                            </a>
                                            @*<img src="@Url.Content(item.Image)" class="border border-primary rounded" alt="Image"
                                                style="width:100px;height:100px;max-width: 100%; height: auto;" />*@

                                        }
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Descripcion)
                                    </td>
                                    <td>
                                        <a value="@item.Categoria.CategoriaId"> @Html.DisplayFor(modelItem => item.Categoria.Descripcion)</a>
                                    </td>

                                    @if (User.IsInRole("Mayorista"))
                                    {
                                        <td>
                                            $@Html.DisplayFor(modelItem => item.PrecioMay)
                                        </td>
                                    }
                                    else
                                    {
                                        <td>
                                            $@Html.DisplayFor(modelItem => item.PrecioMin)
                                        </td>
                                    }

                                    <td>


                                        <div style="padding-left:20px">
                                            @using (Html.BeginForm())
                                            {
                                                @Html.AntiForgeryToken()

                                                <input type="hidden" name="CategoriaId" id="CategoriaId" value="@item.CategoriaId" />
                                                <input type="hidden" name="ProductoId" id="ProductoId" value="@item.ProductoId" />
                                                if (User.IsInRole("Mayorista"))
                                                {
                                                    <input type="hidden" name="PrecioMay" id="PrecioMin" value="@item.PrecioMay" />
                                                }
                                                else
                                                {
                                                    <input type="hidden" name="PrecioMin" id="PrecioMin" value="@item.PrecioMin" />
                                                }
                                                @Html.DropDownList("ColorId", item.ColorId, htmlAttributes: new { @class = "", style = "width:150px" })
                                                <input type="hidden" name="ColorId" id="ColorId" value="@item.ColorId" />
                                                <input type="number" id="Cantidad" name="Cantidad"
                                                       min="1" max="30" value="1">

                                                <input type="submit" value="+ Agregar" class="btn btn-primary btn-sm" name="action:NuevaVenta" />
                                            }
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                    <script type="text/javascript">
                        $(document).ready(function () {
                            $('#productos').DataTable();
                        });
                    </script>

                </div>

                <div class="col-lg-5 col-md-5">
                    <h2 style="color:black">
                        Carrito:
                        <br />

                    </h2>
                    @if (Model.DetallesVentas2.Count > 0)
                    {
                        <table class="table">
                            <tr>
                                <th>
                                    Imagen
                                </th>

                                <th>
                                    @Html.DisplayNameFor(model => model.DetallesVentas2[0].Descripcion)
                                </th>



                                <th>
                                    @Html.DisplayNameFor(model => model.DetallesVentas2[0].Precio)
                                </th>
                                <th>
                                    @Html.DisplayNameFor(model => model.DetallesVentas2[0].Cantidad)
                                </th>

                            </tr>

                            @foreach (var item in Model.DetallesVentas2)
                            {
                                <tr>
                                    <td>
                                        @if (!string.IsNullOrEmpty(item.Product.Image))
                                        {
                                            <img src="@Url.Content(item.Product.Image)" alt="Image" style="width:100px;height:100px;max-width: 100%; height: auto;" />
                                        }
                                    </td>

                                    <td>
                                        @Html.DisplayFor(modelItem => item.Product.Descripcion) (@item.Color.Nombre)

                                    <td style="text-align: right">
                                        $
                                        @if (User.IsInRole("Mayorista"))
                                        {
                                            @Html.DisplayFor(modelItem => item.Product.PrecioMay);
                                        }
                                        else
                                        {
                                            @Html.DisplayFor(modelItem => item.Product.PrecioMin);
                                        }
                                    </td>
                                    <td style="text-align: right">
                                        @Html.DisplayFor(modelItem => item.Cantidad)
                                    </td>


                                    <td>
                                        @Html.ActionLink("X", "DeleteProduct", new { id = item.ProductoId, id2 = item.ColorId }, new { @class = " btn btn-danger" })
                                    </td>
                                </tr>
                            }
                            <tr>
                                <td colspan="4">
                                    Total:
                                </td>

                                <td>
                                    $
                                    @if (User.IsInRole("Mayorista"))
                                    {
                                        @Html.DisplayFor(model => model.TotalValueMay);
                                    }
                                    else
                                    {
                                        @Html.DisplayFor(model => model.TotalValue);

                                    }

                                </td>

                            </tr>

                        </table>
                        <form method="get" action="@Url.Action("Create", "Ventas" )">
                            <input type="submit" class="btn btn-success btn-size small" value="Continuar >>" />

                        </form>

                    }
                    else
                    {
                        <h5 style="color:black">No añadiste ningún producto.</h5>
                    }

                </div>
            </div>

        </div>
    </header>

</body>


<footer class="footer py-4">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-4 text-lg-left">Copyright © www.bazaverlobos.com.ar 2020</div>
            <div class="col-lg-4 my-3 my-lg-0">

            </div>
            <div class="col-lg-4 text-lg-right">
                <a class="btn btn-dark btn-social mx-2" href="https://www.instagram.com/bazaverlobos/"><i class="fab fa-instagram"></i></a>
                <a class="mr-3" href="https://www.instagram.com/bazaverlobos/">@@BazaverLobos</a>
                @*<a class="mr-3" href="#!">Privacy Policy</a>
                    <a href="#!">Terms of Use</a>*@
            </div>
        </div>
    </div>
</footer>


<div class="modal fade image-modal" id="imageModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="descripcion">Descripcion</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="container">
                <div class="modal-body">
                    <div>
                        <img class="border border-primary rounded" id="img" alt="image" style="width:500px;height:500px;max-width: 100%; height: auto;">
                        @*@if (!string.IsNullOrEmpty(Image))
                            {
                              <img src="@Url.Content()" alt="Image" style="width:100px;height:100px;max-width: 100%; height: auto;" />
                            }*@
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Cerrar</button>

            </div>
        </div>
    </div>
</div>


<script src="~/Content/js/scriptuar >>
                        </a>s.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>


<script>
    $(document).ready(function () {
        $(document).on("click", ".image-link", function () {
            var productName = $(this).data('productname');
            $(".image-modal #Descripcion").val(productName);
            document.getElementById('descripcion').innerHTML
                = productName;
            var image = $(this).data('image');
            $(".image-modal #Image").val(image);
            document.getElementById('img').src = image;

        });
    });
</script>
